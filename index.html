<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Subtitles for SVT</title>
    <meta name="SVT - på engelska!" content="description"/>
    <link rel="stylesheet" href="./stylesheet.css" type="text/css" />
    <style type="text/css">.body { width: auto; }</style>
  </head>
  <body>
    <div class="logo">
      <h1>subtitles for</h1>
      <h1 class="svt-large">SVT</h1>  
    </div>
    <hr class="green-line">
    <h2>LET'S WATCH!</h2>
    <h4>1. Start the local server</h4>
    <div class="instructions"></div>
      <p>
          Double click the
          <code class="command">localServer</code>
          icon in this folder and wait for the text below to appear:
          <br>
          <code class="output">
              Serving HTTP on :: port 8000 (http://[::]:8000/) ...
          </code>
      </p>
    <div class="instructions"></div>
    <h4>2. Open the SVT Play</h4>
    <div class="instructions">
      <p>
        Open the page of the programme you want to watch (e.g. <a href="https://www.svtplay.se/video/julkalendern-kronprinsen-som-forsvann">Julkalendern</a>).
        <br>
        Once the page has loaded, open the <code class="output">Console</code> by clicking <code class="command">Option + ⌘ + J</code>, paste the code below, and press enter:
      </p>
    </div>
        <pre class="js-code">
            <object class="js-code" data="browserScript.js"></object>
        </pre>
    <h4>3. Press Play</h4>
    <p>
        Enjoy!
    </p>

    <h4>4. Set up bookmarklet to run script (optional)</h4>
    <div class="instructions">
      <p>
        To avoid having to copy-paste the script each time, you can instead use a bookmarklet to execute the script. Drag the below box to your bookmark bar.
      </p>
      <div class="dragable">
        <a role="button" href="javascript:(function(){let playButton=document.querySelector(&quot;[data-rt*='play-button']&quot;);function displayText(){console.log(&quot;Starting translation...&quot;),setTimeout((function(){observer.observe(document.querySelectorAll(&quot;[class*='text-tracks']&quot;)[0],{subtree:!0,childList:!0,attributes:!0})}),1e3)}async function translate(t){return await fetch(&quot;http://localhost:8000&quot;,{method:&quot;POST&quot;,body:JSON.stringify({q:t,source:&quot;sv&quot;,target:&quot;en&quot;,format:&quot;text&quot;,api_key:&quot;&quot;}),headers:{&quot;Content-Type&quot;:&quot;application/json&quot;}}).then((t=>t.json())).then((t=>t.translatedText)).catch((t=>&quot;Failed to translate...&quot;))}async function formatText(t){if(t.length<=42)return t;let e=(t.match(/<br>/g)||[]).length;if(t.length/Math.max(1,e)>84||0===e&amp;&amp;t.length>42){let e=42,n=e,r=!0;for(;r&amp;&amp;n>0;)[&quot; &quot;,&quot;.&quot;,&quot;!&quot;,&quot;?&quot;,&quot;,&quot;,&quot;-&quot;,&quot;:&quot;,&quot;;&quot;].includes(t[n])?(e=n,r=!1):n-=1;var a=t.slice(0,e)+&quot;<br>&quot;+t.slice(e)}else a=t;return a=a.replace(new RegExp(&quot;<br><br>&quot;,&quot;g&quot;),&quot;<br>&quot;)}playButton.addEventListener(&quot;click&quot;,displayText);const observer=new MutationObserver((async(t,e)=>{if(t[0].addedNodes.length>0){e.disconnect();let t=document.querySelectorAll(&quot;[class*='text-track']&quot;)[0].getElementsByTagName(&quot;span&quot;)[2].innerHTML;document.querySelectorAll(&quot;[class*='text-track']&quot;)[0].getElementsByTagName(&quot;span&quot;)[2].innerHTML=&quot;&quot;;let a=await translate(t),n=await formatText(a);document.querySelectorAll(&quot;[class*='text-track']&quot;)[0].getElementsByTagName(&quot;span&quot;)[2].innerHTML=n,e.observe(document.querySelectorAll(&quot;[class*='text-track']&quot;)[0],{subtree:!0,childList:!0,attributes:!0})}}));}());">Start subtitles translation</a>
      </div>
    </div>
  </body>
</html>